
<main class="container py-5">
  <% if (!user) { %>
    <!-- Landing Section -->
    <section class="text-center mb-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <h1 class="display-4 fw-bold">Welcome to The Privy</h1>
          <p class="lead text-muted">
            Discover posts, stay informed, and share your thoughts with our community.
          </p>
          <!-- CTA Buttons -->
          <div class="mt-4 d-flex justify-content-center gap-3">
            <a href="/auth/login" class="btn btn-primary btn-lg px-4">Login</a>
            <a href="/auth/signup" class="btn btn-outline-primary btn-lg px-4">Sign Up</a>
          </div>
        </div>
      </div>
    </section>
    <!-- Roles & Privileges Cards -->
    <section class="mb-5">
      <div class="row justify-content-center g-4">
        <div class="col-md-5">
          <div class="card border-primary shadow-sm h-100 text-center">
            <div class="card-header bg-primary text-white fw-bold">Guest</div>
            <div class="card-body">
              <p class="card-text text-muted">
                Browse a limited selection of posts anonymously. Authors' identities are hidden.
              </p>
              <p class="fw-semibold text-primary">Read-only access</p>
            </div>
          </div>
        </div>
        <div class="col-md-5">
          <div class="card border-success shadow-sm h-100 text-center">
            <div class="card-header bg-success text-white fw-bold">Member</div>
            <div class="card-body">
              <p class="card-text text-muted">
                Create posts, interact with others, and see authors’ identities.
              </p>
              <p class="fw-semibold text-success">Full access</p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Public posts for guests/unregistered -->
    <section>
      <h4 class="fw-semibold mb-3 text-center">Recent Public Posts</h4>
      <div class="row justify-content-center">
        <div class="col-md-8">
          <% let count = 0; %>
          <% posts.forEach(post => { %>
            <% if (post && count < 5) { %>
              <div class="card mb-3 shadow-sm">
                <div class="card-body">
                  <p class="mb-1"><strong><%= post.authorName || 'Anonymous' %>:</strong></p>
                  <p class="mb-0"><%= post.content %></p>
                </div>
              </div>
              <% count++; %>
            <% } %>
          <% }) %>
        </div>
      </div>
    </section>
  <% } else if (user.role === 'guest') { %>
    <!-- Guest Info Section -->
    <section class="text-center mb-5">
      <div class="row justify-content-center">
        <div class="col-md-6">
          <div class="card shadow-sm h-100">
            <div class="card-body">
              <h5 class="card-title fw-bold text-primary">Guest Access</h5>
              <p class="text-muted mb-2">
                You can only view posts anonymously. Authors' names are hidden.
              </p>
              <p class="text-muted mb-0">
                Sign up as a <strong>Member</strong> to view authors and create posts.
              </p>
              <div class="mt-3">
                <a href="/auth/signup" class="btn btn-outline-primary">Sign Up</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- Limited public posts -->
    <section>
      <h4 class="fw-semibold mb-3 text-center">Recent Public Posts</h4>
      <div class="row justify-content-center">
        <div class="col-md-8">
          <% let count = 0; %>
          <% posts.forEach(post => { %>
            <% if (post && count < 5) { %>
              <div class="card mb-3 shadow-sm">
                <div class="card-body">
                  <p class="mb-1"><strong>Anonymous:</strong></p>
                  <p class="mb-0"><%= post.content %></p>
                </div>
              </div>
              <% count++; %>
            <% } %>
          <% }) %>
        </div>
      </div>
    </section>
    <% } else if (user.role === 'member' || user.role === 'admin') { %>
      <!-- Sleek New Post Section -->
      <section class="row mb-4 justify-content-center">
        <div class="card mb-4 border-0 col-md-8 shadow-sm">
          <div class="card-body">
          <h5 class="card-title mb-3 text-primary fw-semibold">Create a Post</h5>
          <form action="/posts" method="POST">
            <div class="mb-3">
              <textarea name="content" class="form-control" rows="3" placeholder="What's happening?"
                required></textarea>
            </div>
            <button type="submit" class="btn btn-primary w-100 fw-semibold">Post</button>
          </form>
        </div>
      </div>
    </section>
    <!-- All posts feed -->
    <section>
      <h4 class="fw-semibold mb-3 text-center">All Posts</h4>
      <div class="row justify-content-center">
        <div class="col-md-8">
          <% posts.forEach(post => { %>
            <div class="card mb-3 shadow-sm">
              <div class="card-body">
                <p class="mb-1">
                  <strong>
                    <% if (typeof user !== "undefined" && user && user.role !== "guest") { %>
                      <h6 class="fw-semibold text-primary mb-1">@<%= post.username %></h6>
                    <% } else { %>
                      <h6 class="fw-semibold text-secondary mb-1">Anonymous</h6>
                    <% } %>
                  </strong>
                </p>
                <p class="mb-2"><%= post.content %></p>
                <a href="/posts/<%= post.id %>" class="text-decoration-none text-muted">View Post →</a>
              </div>
            </div>
          <% }) %>
        </div>
      </div>
    </section>
  <% } %>
</main>
